<!doctype html>
<!-- Website template by freewebsitetemplates.com -->
<!-- ModelChooser.html - select which evaluation suite and model the user wants to perform.

TODO: see Github Issues
 -->
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>3D Printer Evaluation Model Generator</title>
    <link rel="stylesheet" href="static/external/jquery-ui-1.11.4.custom/jquery-ui.css" type="text/css">
	<link rel="stylesheet" href="static/css/style.css" type="text/css">
    <script src="static/external/jquery.js" type="text/javascript"></script>
    <script src="static/external/jquery-ui-1.11.4.custom/jquery-ui.js" type="text/javascript"></script>
    <script src="static/js/util.js" type="text/javascript"></script>
    <script src="static/js/params.js" type="text/javascript"></script>

	<script>
		$(document).ready(function() {
            // Parse the parameters structure which defines information about the different parameters we'll be testing
            var suite_data = getSuites();

			// populate the table with elements from suite_data:
			var i;
			for(i = 0; i < suite_data.length; i++) {
				console.log(suite_data[i].Name);
			}

			// Initial styling with jqueryui
			$("#accordion").accordion({
				heightStyle: "content"
			});

			return;

            // Generate rows in the Custom section for each parameter, populated with defaults
            var list = $("#model-params-area");
            var template = list.html();
            var id;
            var new_html = "";
            for (id = 0; id < param_data.length; id++) {
                new_html += template
                        .replace("__min_id", param_data[id].varBase + "-min")
                        .replace("__max_id", param_data[id].varBase + "-max")
                        .replace("__name", param_data[id].Name);
            }
            list.html(new_html);

            for (id = 0; id < param_data.length; id++) {
                param_data[id].sMin = $("#" + param_data[id].varBase + "-min").spinner();
                param_data[id].sMax = $("#" + param_data[id].varBase + "-max").spinner();
            }
			
			var pbGen = $("#progressbar").progressbar({value: false, max: 100});

			
			bGenD.click(function(event) {
                var part_params = getUniversalParams();
                var i;
				// fill in the default parameters from the config file, using layerHeight as a valid variable name
                var layerHeight = part_params[LAYER_HEIGHT_VAR];
                // TODO: Find a more secure alternative. Maybe new Function as here:http://www.everythingfrontend.com/posts/studying-javascript-eval.html
                for(i = 0; i < param_data.length; i++) {
                    part_params["min" + param_data[i].varKey] = eval(String(param_data[i].minDefault));
                    part_params["max" + param_data[i].varKey] = eval(String(param_data[i].maxDefault));
                }
				// Generate a generic test part...
				startGenerate(part_params, $("#status"), $("#progressbar"));
				// show the "working" status bar and field
				$("#progress-area").css({"display": "block"});
			});

			bGenG.click(function(event) {
				// Generate a test part based on supplied printer resolution... Defaults are applied in the server
                // (ModelParams.load_json())
                var part_params = getUniversalParams();
                part_params[NOZZLE_DIAMETER_VAR] = $("#resolution").val();
				// fill in the default parameters from the config file, using layerHeight and nozzleDiameter
                // as valid variable names
                var layerHeight = part_params[LAYER_HEIGHT_VAR];
                var nozzleDiameter = part_params[NOZZLE_DIAMETER_VAR];
                // TODO: Find a more secure alternative. Maybe new Function as here:http://www.everythingfrontend.com/posts/studying-javascript-eval.html
                for(i = 0; i < param_data.length; i++) {
                    part_params["min" + param_data[i].varKey] = eval(String(param_data[i].minDefaultND));
                    part_params["max" + param_data[i].varKey] = eval(String(param_data[i].maxDefaultND));
                }
				startGenerate(part_params, $("#status"), $("#progressbar"));
				// show the "working" status bar and field
				$("#progress-area").css({"display": "block"});
			});

			bGenC.click(function(event) {
				// Generate a test part based on specified parameters
                var part_params = getUniversalParams();
                var id;
                for (id = 0; id < param_data.length; id++) {
                    part_params["min" + param_data[id].varKey] = param_data[id].sMin.val();
                    part_params["max" + param_data[id].varKey] = param_data[id].sMax.val();
                }
				startGenerate(part_params, $("#status"), $("#progressbar"));
				// show the "working" status bar and field
				$("#progress-area").css({"display": "block"});
			});

            bNext.click(function(event) {
                // Check to see if a part has been generated (data is not null)
                // FUTURE: Also check for a bookmarked page by looking for # metadata in the url. Use
                // window.location.hash.substring(1) to retrieve
                if (!generated)  {
                    if((typeof part_params["layer_height"] === "undefined")) {
                        alert("Please generate a test part");
                        return;
                    }
                    else
                        if (!confirm("The test part has not finished generating. Continue anyway?"))
                            return;
                }
                // Redirect to the new url
                location.href = "iterate#" + $.param(part_params);
            });
		});

		function getUniversalParams() {
			// Returns an object with the parameters that are used by all "Generate" buttons
			var part_params = {};

			part_params[LAYER_HEIGHT_VAR] = $("#layerheight").val();
			part_params[GROUP_NAME_VAR] = encodeURIstring($("#groupname").val());

			return part_params;
		}
	</script>
</head>
<body>
	<div id="page">
		<div id="header">
			<div>
				<a href="index" class="logo"><img src="static/images/logo.png" alt=""></a>
				<ul id="navigation">
					<li class="selected">
						<a href="index">Home</a>
					</li>
					<li class="menu">
						<a href="static/help.html">Help</a>
					</li>
				</ul>
			</div>
		</div>
		<div id="body" class="home">
            <img class="bigimage" src="static/images/Start.png" style="width:250px">
            <div class="bodytext">
                <h1>Select a Test Suite and Model</h1>
                <p>A variety of test models can be used with this wizard interface to test different aspects of your
					printer's capabilities. The models are organized into Test Suites based on the kinds of characteristics
					they evaluate.
                </p>
				<div id="accordion">
					<h3 id="template-suite-heading">Use Defaults</h3>
					<div id="template-suite-body">
						<p id="template-suite-description">Suite Description</p>

						<div id="template-model" style="clear:left">
							<img id="template-model-image" class="modelchooser-image" src="__src" width="50" height="50">
							<h4><a href="__nextpage" id="template-model-name"></a></h4>
							<p id="template-model-description">Model Description</p>
							<button class="button" id="generate-default">
								<span class="ui-button-text">Generate Part</span>
							</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div id="footer">
		<div>
			<p>&copy; 2016 Ben Weiss; University of Washington</p>
		</div>
	</div>
</body>
</html>
